schemaVersion: 2.2.0
metadata:
  name: eap73-legacy-app
  version: 1.0.0
  description: Devfile for running legacy-app on JBoss EAP 7.3.10

components:
  - name: eap73-runtime
    container:
      image: registry.redhat.io/jboss-eap-7/eap73-openjdk11-openshift-rhel8:7.3.10-2
      memoryLimit: "2Gi"
      cpuLimit: "1"
      mountSources: true
      sourceMapping: /projects
      endpoints:
        - name: http
          targetPort: 8080
          exposure: public
          protocol: http
      env:
        - name: JAVA_OPTS
          value: "-Xms512m -Xmx1024m"

commands:
  - id: build-app
    exec:
      label: "Build legacy-app WAR"
      component: eap73-runtime
      commandLine: "mvn clean package"
      workingDir: /projects
      group:
        kind: build
        isDefault: true

  - id: deploy-app
    exec:
      label: "Deploy legacy-app.war"
      component: eap73-runtime
      commandLine: "cp /projects/target/legacy-app.war /opt/eap/standalone/deployments/"
      workingDir: /projects
      group:
        kind: build

  - id: start-eap
    exec:
      label: "Start EAP Server"
      component: eap73-runtime
      commandLine: "./standalone.sh -b 0.0.0.0 -c standalone-openshift.xml"
      workingDir: /opt/eap/bin
      group:
        kind: run
        isDefault: true